(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{71:function(t,e,r){"use strict";r.r(e),r.d(e,"protocol",(function(){return R})),r.d(e,"PacketType",(function(){return B})),r.d(e,"Encoder",(function(){return O})),r.d(e,"Decoder",(function(){return T}));var n=r(98);const o="function"==typeof ArrayBuffer,c=t=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,f=Object.prototype.toString,l="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===f.call(Blob),h="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===f.call(File);function d(t){return o&&(t instanceof ArrayBuffer||c(t))||l&&t instanceof Blob||h&&t instanceof File}function y(t,e){if(!t||"object"!=typeof t)return!1;if(Array.isArray(t)){for(let i=0,e=t.length;i<e;i++)if(y(t[i]))return!0;return!1}if(d(t))return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return y(t.toJSON(),!0);for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&y(t[e]))return!0;return!1}function N(t){const e=[],r=t.data,n=t;return n.data=A(r,e),n.attachments=e.length,{packet:n,buffers:e}}function A(data,t){if(!data)return data;if(d(data)){const e={_placeholder:!0,num:t.length};return t.push(data),e}if(Array.isArray(data)){const e=new Array(data.length);for(let i=0;i<data.length;i++)e[i]=A(data[i],t);return e}if("object"==typeof data&&!(data instanceof Date)){const e={};for(const r in data)Object.prototype.hasOwnProperty.call(data,r)&&(e[r]=A(data[r],t));return e}return data}function E(t,e){return t.data=w(t.data,e),delete t.attachments,t}function w(data,t){if(!data)return data;if(data&&!0===data._placeholder){if("number"==typeof data.num&&data.num>=0&&data.num<t.length)return t[data.num];throw new Error("illegal attachments")}if(Array.isArray(data))for(let i=0;i<data.length;i++)data[i]=w(data[i],t);else if("object"==typeof data)for(const e in data)Object.prototype.hasOwnProperty.call(data,e)&&(data[e]=w(data[e],t));return data}const C=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],R=5;var B;!function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"}(B||(B={}));class O{constructor(t){this.replacer=t}encode(t){return t.type!==B.EVENT&&t.type!==B.ACK||!y(t)?[this.encodeAsString(t)]:this.encodeAsBinary({type:t.type===B.EVENT?B.BINARY_EVENT:B.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}encodeAsString(t){let e=""+t.type;return t.type!==B.BINARY_EVENT&&t.type!==B.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=N(t),r=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(r),n}}function m(t){return"[object Object]"===Object.prototype.toString.call(t)}class T extends n.a{constructor(t){super(),this.reviver=t}add(t){let e;if("string"==typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const r=e.type===B.BINARY_EVENT;r||e.type===B.BINARY_ACK?(e.type=r?B.EVENT:B.ACK,this.reconstructor=new k(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!d(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let i=0;const p={type:Number(t.charAt(0))};if(void 0===B[p.type])throw new Error("unknown packet type "+p.type);if(p.type===B.BINARY_EVENT||p.type===B.BINARY_ACK){const e=i+1;for(;"-"!==t.charAt(++i)&&i!=t.length;);const r=t.substring(e,i);if(r!=Number(r)||"-"!==t.charAt(i))throw new Error("Illegal attachments");p.attachments=Number(r)}if("/"===t.charAt(i+1)){const e=i+1;for(;++i;){if(","===t.charAt(i))break;if(i===t.length)break}p.nsp=t.substring(e,i)}else p.nsp="/";const e=t.charAt(i+1);if(""!==e&&Number(e)==e){const e=i+1;for(;++i;){const e=t.charAt(i);if(null==e||Number(e)!=e){--i;break}if(i===t.length)break}p.id=Number(t.substring(e,i+1))}if(t.charAt(++i)){const e=this.tryParse(t.substr(i));if(!T.isPayloadValid(p.type,e))throw new Error("invalid payload");p.data=e}return p}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return!1}}static isPayloadValid(t,e){switch(t){case B.CONNECT:return m(e);case B.DISCONNECT:return void 0===e;case B.CONNECT_ERROR:return"string"==typeof e||m(e);case B.EVENT:case B.BINARY_EVENT:return Array.isArray(e)&&("number"==typeof e[0]||"string"==typeof e[0]&&-1===C.indexOf(e[0]));case B.ACK:case B.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class k{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=E(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}}}]);